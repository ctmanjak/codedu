language: python
python:
  - '3.6'

env:
  - "DB_PASSWORD=travis"

services:
  - mysql
  - docker

before_install:
  - sudo rm -f /etc/docker/daemon.json
  - sudo ls -al /etc/docker/
  - sudo cp ./config/daemon-test.json /etc/docker/daemon.json
  - mysql -e 'CREATE DATABASE codedu;'

install:
  - pip install -r requirements.txt

script:
  - pytest test

before_deploy:
  - sudo systemctl restart docker

deploy:
  provider: script
  script: sudo bash docker-deploy.sh